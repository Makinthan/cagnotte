<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Cagnotte Anniversaire</title>
  <link rel="stylesheet" href="style.css">
</head>
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js"></script>

<script>
  // Ton code de configuration Firebase ici (remplace les valeurs !)
  const firebaseConfig = {
    apiKey: "AIzaSyC1ZycY0cYZiaz2O9MK7cvEwzFKbEqacIM",
    authDomain: "cagnotte-anniversaire.firebaseapp.com",
    projectId: "cagnotte-anniversaire",
    storageBucket: "cagnotte-anniversaire.firebasestorage.app",
    messagingSenderId: "184571650038",
    appId: "1:184571650038:web:58817849bd1986bdfd71d7"
  };

  // Initialisation Firebase
  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
</script>

<!-- Ton script principal -->
<script src="script.js"></script>

<body>
  <div class="container">
    <button class="admin-btn" onclick="afficherAdmin()">ğŸ”‘ AccÃ¨s admin</button>
    <button id="logoutBtn" class="admin-btn" onclick="deconnexionAdmin()" style="display: none;">
      ğŸšª DÃ©connexion
    </button>  
    <h1>ğŸ‰ Cadeau pour l'anniversaire de Jen ğŸ‚</h1>
    <p id="description"> Coucou tout le monde ! Pour les 27 ans de Jen, elle a souhaitÃ© avoir un nouveau sac (et oui encore ğŸ˜…).<br />
      Donc comme l'annÃ©e derniÃ¨re je fais une cagnotte (je rÃ©cupÃ¨re tout psq flemme de payer des frais aux plateformes) comme Ã§a on peut le lui offrir.
      Vous pourrez suivre l'avancÃ© de la cagnotte ici et la liste des participants (mp moi si problÃ¨me)<br /><br />
      Merci Ã  tous pour votre participation ğŸ˜</p>
    <p>Model du sac : <a  href = "https://www.bhv.fr/p/sac+a+main+hobo+courage+28+en+cuir-coach/10179578/60" target="_blank"> Sac COACH</a><br />
    Couleur : Jaune (dispo seulement en boutique)</p>
    <h2>
      Montant rÃ©coltÃ© : <input id="montant" type="text" readonly> â‚¬
      <button id="editBtn" onclick="modifierMontant()" style="display: none;">âœï¸</button>
    </h2>
   
      <div id="progress-container">
        <div id="progress-bar"></div>
      </div>
      <p id="objectif-text">Objectif : 350 â‚¬</p>
      <button class="participer" onclick="afficherPopup()">ğŸ Je participe</button>
      <!-- Zone de texte des participants -->
      <div id="participants-section">
        <h3>Participants</h3>
        <textarea id="participants" placeholder="Liste des participants..." readonly></textarea>
      </div>
      
      <button id="editBtn" onclick="modifierMontant()" style="display: none;">âœï¸</button>
    </div>

    
  </div>

  <!-- Pop-up -->
  <div id="popup" class="popup">
    <div class="popup-content">
      <span class="close" onclick="fermerPopup()">Ã—</span>
      <h2>Participer Ã  la cagnotte</h2>
      <div class="paiement">
        <div>
          <h3>Via PayPal</h3>
          <img src="paypal-qr.png" alt="QR Code PayPal" class="qr">
        </div>
        <div>
          <h3>Ou via Wero</h3>
          <p id ="warning"> âš ï¸ Bien vÃ©rifier que mon nom s'affiche une fois le numÃ©ro entrÃ©</p>
          <p>
            ğŸ“± <span id="numero">06 52 42 87 77</span>
            <button class="copy-button" onclick="copierNumero()">Copier</button>
          </p>
        </div>
        
      </div>
    </div>
  </div>

  <script>
    /*************/
    /*** JAVA ***/
    /*************/
    const OBJECTIF = 350;
    function mettreAJourProgressBar(montant) {
      // const OBJECTIF = 500; // ou la valeur que tu veux
      const pourcentage = Math.min((parseFloat(montant) / OBJECTIF) * 100, 100);
      document.getElementById("progress-bar").style.width = pourcentage + "%";
    }

    // Afficher le montant sauvegardÃ© au chargement
    window.onload = function () {
      const saved = localStorage.getItem("montantCagnotte");
      if (saved) {
        document.getElementById("montant").value = saved;
        mettreAJourProgressBar(saved);
      }

      const participants = localStorage.getItem("listeParticipants");
      if (participants) {
        document.getElementById("participants").value = participants;
      }
  
      const adminActif = sessionStorage.getItem("adminConnecte");
      if (adminActif === "true") {
        document.getElementById("editBtn").style.display = "inline-block";
        document.getElementById("logoutBtn").style.display = "inline-block";
        document.getElementById("participants").removeAttribute("readonly");
      }
      else {
        document.getElementById("participants").setAttribute("readonly", true);
      }
    };
  
    function afficherPopup() {
      document.getElementById("popup").style.display = "flex";
    }
  
    function fermerPopup() {
      document.getElementById("popup").style.display = "none";
    }
  
    function modifierMontant() {
      const montantInput = document.getElementById("montant");
      const nouveau = prompt("Nouveau montant de la cagnotte :", montantInput.value);
      if (nouveau !== null && nouveau.trim() !== "") {
        montantInput.value = nouveau;
        localStorage.setItem("montantCagnotte", nouveau); // ğŸ’¾ Sauvegarde
        mettreAJourProgressBar(nouveau);
      }
    }
  
    function afficherAdmin() {
      const motDePasse = prompt("Mot de passe admin :");
      if (motDePasse === "anniv2025") {
        sessionStorage.setItem("adminConnecte", "true");
        document.getElementById("editBtn").style.display = "inline-block";
        document.getElementById("logoutBtn").style.display = "inline-block";
        document.getElementById("participants").removeAttribute("readonly");
      } else {
        alert("Mot de passe incorrect.");
      }
    }


    function deconnexionAdmin() {
      sessionStorage.removeItem("adminConnecte");
      document.getElementById("editBtn").style.display = "none";
      document.getElementById("logoutBtn").style.display = "none";
      document.getElementById("participants").setAttribute("readonly", true);
      alert("DÃ©connectÃ© de l'admin.");
    }

    document.getElementById("participants")?.addEventListener("input", function () {
      if (!this.hasAttribute("readonly")) {
        localStorage.setItem("listeParticipants", this.value);
      }
    });

    function copierNumero() {
      const numero = document.getElementById("numero").innerText;
      const textarea = document.createElement("textarea");
      textarea.value = numero;
      document.body.appendChild(textarea);
      textarea.select();
      try {
        document.execCommand("copy");
        alert("NumÃ©ro copiÃ© !");
      } catch (err) {
        alert("La copie a Ã©chouÃ©.");
      }
      document.body.removeChild(textarea);
    }
    const montantElem = document.getElementById("montant");
    const descriptionElem = document.getElementById("description");
    const participantsElem = document.getElementById("participants");
    
    // Fonction de mise Ã  jour depuis Firebase
    function lireDonnees() {
      const ref = firebase.database().ref("/");
    
      ref.on("value", (snapshot) => {
        const data = snapshot.val();
        if (!data) return;
    
        // Montant
        montantElem.textContent = data.montant + " â‚¬";
    
        // Description
        descriptionElem.textContent = data.description;
    
        // Participants
        participantsElem.innerHTML = "";
        if (Array.isArray(data.participants)) {
          data.participants.forEach((nom) => {
            const li = document.createElement("li");
            li.textContent = nom;
            participantsElem.appendChild(li);
          });
        }
      });
    }
    
    // Appeler la fonction au chargement
    lireDonnees();

  </script>
  
</body>
</html>
