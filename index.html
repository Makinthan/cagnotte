<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Cagnotte Anniversaire</title>
  <link rel="stylesheet" href="style.css">
</head>
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js"></script>

<script>
  // Ton code de configuration Firebase ici (remplace les valeurs !)
  const firebaseConfig = {
    apiKey: "AIzaSyC1ZycY0cYZiaz2O9MK7cvEwzFKbEqacIM",
    authDomain: "cagnotte-anniversaire.firebaseapp.com",
    projectId: "cagnotte-anniversaire",
    storageBucket: "cagnotte-anniversaire.firebasestorage.app",
    messagingSenderId: "184571650038",
    appId: "1:184571650038:web:58817849bd1986bdfd71d7"
  };

  // Initialisation Firebase
  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
</script>

<body>
  <div class="container">
    <button class="admin-btn" onclick="afficherAdmin()">ğŸ”‘ AccÃ¨s admin</button>
    <button id="logoutBtn" class="admin-btn" onclick="deconnexionAdmin()" style="display: none;">
      ğŸšª DÃ©connexion
    </button>  
    <h1>ğŸ‰ Cadeau pour l'anniversaire de Jen ğŸ‚</h1>
    <p id="description"> Coucou tout le monde ! Pour les 27 ans de Jen, elle a souhaitÃ© avoir un nouveau sac (et oui encore ğŸ˜…).<br />
      Donc comme l'annÃ©e derniÃ¨re je fais une cagnotte (je rÃ©cupÃ¨re tout psq flemme de payer des frais aux plateformes) comme Ã§a on peut le lui offrir.
      Vous pourrez suivre l'avancÃ© de la cagnotte ici et la liste des participants (mp moi si problÃ¨me)<br /><br />
      Merci Ã  tous pour votre participation ğŸ˜</p>
    <p>Model du sac : <a  href = "https://www.bhv.fr/p/sac+a+main+hobo+courage+28+en+cuir-coach/10179578/60" target="_blank"> Sac COACH</a><br />
    Couleur : Jaune (dispo seulement en boutique)</p>
    <h2>
      Montant rÃ©coltÃ© : <input id="montant" type="text" readonly> â‚¬
      <button id="editBtn" onclick="modifierMontant()" style="display: none;">âœï¸</button>
    </h2>
   
      <div id="progress-container">
        <div id="progress-bar"></div>
      </div>
      <p id="objectif-text">Objectif : 350 â‚¬</p>
      <button class="participer" onclick="afficherPopup()">ğŸ Je participe</button>
      <!-- Zone de texte des participants -->
      <div id="participants-section">
        <h3>Participants</h3>
        <textarea id="participants" placeholder="Liste des participants..." readonly></textarea>
      </div>
    </div>

    
  </div>

  <!-- Pop-up -->
  <div id="popup" class="popup">
    <div class="popup-content">
      <span class="close" onclick="fermerPopup()">Ã—</span>
      <h2>Participer Ã  la cagnotte</h2>
      <div class="paiement">
        <div>
          <h3>Via PayPal</h3>
          <img src="paypal-qr.png" alt="QR Code PayPal" class="qr">
        </div>
        <div>
          <h3>Ou via Wero</h3>
          <p id ="warning"> âš ï¸ Bien vÃ©rifier que mon nom s'affiche une fois le numÃ©ro entrÃ©</p>
          <p>
            ğŸ“± <span id="numero">06 52 42 87 77</span>
            <button class="copy-button" onclick="copierNumero()">Copier</button>
          </p>
        </div>
        
      </div>
    </div>
  </div>

  <script>
    /*************/
    /*** JAVA ***/
    /*************/
    // Constantes utiles
const OBJECTIF = 350;
const montantElem = document.getElementById("montant");
const participantsElem = document.getElementById("participants");
const descriptionElem = document.getElementById("description");

// METTRE Ã€ JOUR BARRE DE PROGRESSION
function mettreAJourProgressBar(montant) {
  const pourcentage = Math.min((parseFloat(montant) / OBJECTIF) * 100, 100);
  document.getElementById("progress-bar").style.width = pourcentage + "%";
}

// MODIFIER LE MONTANT (admin uniquement)
function modifierMontant() {
  const nouveau = prompt("Nouveau montant de la cagnotte :");
  if (nouveau !== null && nouveau.trim() !== "") {
    firebase.database().ref("montant").set(nouveau);
  }
}

// AFFICHER ZONE ADMIN
function afficherAdmin() {
  const motDePasse = prompt("Mot de passe admin :");
  if (motDePasse === "anniv2025") {
    sessionStorage.setItem("adminConnecte", "true");
    document.getElementById("editBtn").style.display = "inline-block";
    document.getElementById("logoutBtn").style.display = "inline-block";
    participantsElem.contentEditable = "true";
    descriptionElem.contentEditable = "true";
  } else {
    alert("Mot de passe incorrect.");
  }
}

// DÃ‰CONNEXION ADMIN
function deconnexionAdmin() {
  sessionStorage.removeItem("adminConnecte");
  document.getElementById("editBtn").style.display = "none";
  document.getElementById("logoutBtn").style.display = "none";
  participantsElem.contentEditable = "false";
  descriptionElem.contentEditable = "false";
  alert("DÃ©connectÃ© de l'admin.");
}

// Ã‰COUTER LES CHANGEMENTS FIREBASE EN TEMPS RÃ‰EL
function ecouterFirebase() {
  firebase.database().ref("montant").on("value", (snap) => {
    const montant = snap.val();
    montantElem.textContent = montant + " â‚¬";
    mettreAJourProgressBar(montant);
  });

  firebase.database().ref("participants").on("value", (snap) => {
    const data = snap.val();
    participantsElem.innerHTML = "";
    if (Array.isArray(data)) {
      data.forEach(nom => {
        const li = document.createElement("li");
        li.textContent = nom;
        participantsElem.appendChild(li);
      });
    }
  });

  firebase.database().ref("description").on("value", (snap) => {
    const texte = snap.val();
    descriptionElem.textContent = texte;
  });
}

// SAUVEGARDE DE PARTICIPANTS (admin uniquement)
participantsElem.addEventListener("input", () => {
  if (sessionStorage.getItem("adminConnecte") === "true") {
    const noms = Array.from(participantsElem.querySelectorAll("li"))
      .map(li => li.textContent.trim())
      .filter(nom => nom !== "");
    firebase.database().ref("participants").set(noms);
  }
});

// SAUVEGARDE DE DESCRIPTION (admin uniquement)
descriptionElem.addEventListener("input", () => {
  if (sessionStorage.getItem("adminConnecte") === "true") {
    firebase.database().ref("description").set(descriptionElem.textContent.trim());
  }
});

// POPUP
function afficherPopup() {
  document.getElementById("popup").style.display = "flex";
}
function fermerPopup() {
  document.getElementById("popup").style.display = "none";
}

// COPIER NUMÃ‰RO
function copierNumero() {
  const numero = document.getElementById("numero").innerText;
  const textarea = document.createElement("textarea");
  textarea.value = numero;
  document.body.appendChild(textarea);
  textarea.select();
  try {
    document.execCommand("copy");
    alert("NumÃ©ro copiÃ© !");
  } catch (err) {
    alert("Ã‰chec de la copie");
  }
  document.body.removeChild(textarea);
}

// INIT AU CHARGEMENT
window.onload = function () {
  ecouterFirebase();

  const admin = sessionStorage.getItem("adminConnecte");
  if (admin === "true") {
    document.getElementById("editBtn").style.display = "inline-block";
    document.getElementById("logoutBtn").style.display = "inline-block";
    participantsElem.contentEditable = "true";
    descriptionElem.contentEditable = "true";
  } else {
    participantsElem.contentEditable = "false";
    descriptionElem.contentEditable = "false";
  }
};

  </script>
  
</body>
</html>
